<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title data-en="WebSpeech V - Voice Clone Tool" data-cn="WebSpeech V - 语音克隆工具">WebSpeech V</title>
    
    <!-- Bootstrap CSS (kept for grid system) -->
    <link href="/static/js/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom CSS - Modular Structure -->
    <link href="/static/css/themes.css" rel="stylesheet">
    <link href="/static/css/main.css" rel="stylesheet">
    <link href="/static/css/components.css" rel="stylesheet">
    
    <!-- Layer.js CSS -->
    <link href="/static/js/layer/theme/default/layer.css" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="header-content">
            <div class="logo-section">
                <img src="/static/images/logo_macmilling.png" alt="MacMilling Logo">
                <div>
                    <h1 class="app-title" data-en="WebSpeech V" data-cn="WebSpeech V">WebSpeech V</h1>
                    <p class="app-subtitle" data-en="by MacMilling Computer-Software Entertainment Technologies" 
                       data-cn="by MacMilling Computer-Software Entertainment Technologies">
                       by MacMilling Computer-Software Entertainment Technologies
                    </p>
                </div>
            </div>
            <div class="header-actions">
                <a href="https://github.com/MacMilling/webspeech-v/releases" target="_blank"
                   class="d-none btn btn-sm btn-link text-danger" id="checkupdate"></a>
                <a class="btn btn-sm btn-link" href="https://github.com/MacMilling/webspeech-v" target="_blank">Github</a>
                <a class="btn btn-sm btn-link" href="https://github.com/MacMilling/webspeech-v/issues" target="_blank"
                   data-en="Post a Issue" data-cn="遇到问题?">Post a Issue</a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-wrapper">
        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Info Alert -->
            <div class="alert alert-info" role="alert">
                <h4 class="alert-heading d-flex justify-content-between align-items-center">
                    <span data-en="Voice Clone Tool v{{ version }}" data-cn="语音克隆工具 v{{ version }}">
                        Voice Clone Tool v{{ version }}
                    </span>
                </h4>
                <hr>
                <div>
                    <p class="mb-0" data-en="Record an audio segment with your own voice or using any tone"
                       data-cn="用自己的声音或使用任意音色录制一段音频">
                       Record an audio segment with your own voice or using any tone
                    </p>
                    <p class="mb-0"
                       data-en="The optimal audio material duration for cloning is 30-120s, ensuring clear and accurate vocals without any noise or background noise"
                       data-cn="用于克隆的最佳音频素材时长为 30s-120s，确保清晰准确的人声，不要有杂音、背景音">
                       The optimal audio material duration for cloning is 30-120s
                    </p>
                </div>
            </div>

            <!-- Mode Toggle -->
            <div class="mode-toggle">
                <button class="btn btn-primary" data-mode="tts" data-en="Text → Speech" data-cn="文字→声音">Text → Speech</button>
                <button class="btn" data-mode="sts" data-en="Speech → Speech" data-cn="声音→声音">Speech → Speech</button>
            </div>

            <!-- Model Manager -->
            <div class="model-list" id="model_list">
                <!-- Model buttons will be injected here by JavaScript -->
            </div>

            <!-- TTS Area -->
            <div id="tts-area">
                <div class="content-card">
                    <div class="parameters-section">
                        <div class="parameter-group">
                            <label for="model" class="form-label" data-en="Model:" data-cn="使用模型：">Model:</label>
                            <select class="form-select" name="model" id="model">
                                <option value="default" data-cn="默认" data-en="Default">Default</option>
                            </select>
                        </div>
                        
                        <div class="parameter-group">
                            <label for="languageSelect" class="form-label" data-en="Language:" data-cn="文本语言：">Language:</label>
                            <select class="form-select" id="languageSelect">
                                <option data-en="Chinese" value="zh-cn" data-cn="中文">Chinese</option>
                                <option data-en="English" value="en" data-cn="英语">English</option>
                                <option data-en="Japanese" value="ja" data-cn="日语">Japanese</option>
                                <option data-en="Korean" value="ko" data-cn="韩语">Korean</option>
                                <option data-en="Spanish" value="es" data-cn="西班牙语">Spanish</option>
                                <option data-en="German" value="de" data-cn="德语">German</option>
                                <option data-en="French" value="fr" data-cn="法语">French</option>
                                <option data-en="Italian" value="it" data-cn="意大利语">Italian</option>
                                <option data-en="Turkish" value="tr" data-cn="土耳其语">Turkish</option>
                                <option data-en="Russian" value="ru" data-cn="俄语">Russian</option>
                                <option data-en="Portuguese" value="pt" data-cn="葡萄牙语">Portuguese</option>
                                <option data-en="Polish" value="pl" data-cn="波兰语">Polish</option>
                                <option data-en="Dutch" value="nl" data-cn="荷兰语">Dutch</option>
                                <option data-en="Arabic" value="ar" data-cn="阿拉伯语">Arabic</option>
                                <option data-en="Hungarian" value="hu" data-cn="匈牙利语">Hungarian</option>
                                <option data-en="Czech" value="cs" data-cn="捷克语">Czech</option>
                            </select>
                        </div>
                        
                        <div class="parameter-group">
                            <label for="speed" class="form-label" data-en="Speed (0.1-2.0):" data-cn="速度倍数(0.1-2.0)：">Speed:</label>
                            <input id="speed" name="speed" class="form-control" type="number"
                                   min="0.1" max="2.0" step="0.05" value="1.0">
                        </div>
                        
                        <div class="parameter-group">
                            <label for="audioSelect" class="form-label">
                                <span data-en="Voice File:" data-cn="声音文件:">Voice File:</span>
                                <a href="javascript:;" id="voiceAuditionBtn"
                                   class="btn btn-sm btn-link" data-en="Preview" data-cn="试听">Preview</a>
                            </label>
                            <select class="form-select" id="audioSelect"></select>
                            <div class="form-text mt-1">
                                <label class="btn btn-sm btn-secondary btn-file d-inline-block position-relative">
                                    <span data-en="Upload from Local" data-cn="从本地上传">Upload from Local</span>
                                    <input id="fileInput" type="file" accept="audio/wav, audio/mp3, audio/flac"
                                           class="position-absolute start-0 top-0 end-0 bottom-0 opacity-0"/>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Recording Controls -->
                    <div class="recording-controls my-3">
                        <button class="btn btn-sm btn-primary" id="startRecord" data-en="Start Recording" data-cn="开始录制">Start Recording</button>
                        <button class="btn btn-sm btn-danger" id="stopRecord" disabled data-en="Stop Recording" data-cn="停止录制">Stop Recording</button>
                        <button class="btn btn-sm btn-success" id="upload" disabled data-en="Use this Recording" data-cn="使用该录音">Use this Recording</button>
                        <audio class="mt-1" id="audioPlayer" controls style="max-width: 300px;"></audio>
                    </div>

                    <!-- Text Input -->
                    <div class="form-group">
                        <label for="textInput" class="form-label" data-en="Text to Synthesize:" data-cn="要合成的文字：">Text to Synthesize:</label>
                        <textarea {% if not text_model %} disabled {% endif %} class="form-control"
                                  id="textInput" placeholder-cn="在此输入要合成的文字"
                                  placeholder-en="Enter text to synthesize" rows="5"></textarea>
                        {% if text_model %}
                            <label class="btn-file btn-secondary-srt mt-2">
                                <span class="btn btn-sm btn-secondary" data-en="Import SRT File" data-cn="导入srt文件">Import SRT File</span>
                                <input type="file" accept=".srt"
                                       class="position-absolute start-0 top-0 end-0 bottom-0 opacity-0">
                            </label>
                        {% else %}
                            <div class="alert alert-danger my-2">
                                <span data-en="The model needs to be downloaded before it can be used. If the source code is deployed, please execute `python code_dev.py` to download the model online"
                                      data-cn="需要下载模型后才可使用，如果源码部署，请执行 python code_dev.py 在线下载模型">
                                    Model required
                                </span>
                                <a href="https://github.com/jianchang512/clone-voice/releases/tag/v0.0.1"
                                   target="_blank" data-en="Download model" data-cn="下载模型">Download model</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- STS Area -->
            <div id="sts-area" class="d-none">
                <div class="content-card">
                    <div class="form-group">
                        <label for="audioSelect2" class="form-label">
                            <span data-en="Voice to Clone:" data-cn="要克隆的音色:">Voice to Clone:</span>
                        </label>
                        <select class="form-select d-inline-block w-auto" id="audioSelect2"></select>
                    </div>
                    
                    {% if voice_model %}
                        <div id="dropaudio" class="drop-area"
                             data-en="Drag and drop or click to upload audio files"
                             data-cn="拖拽或点击将音频 wav/mp3/flac 文件上传">
                            Drag and drop or click to upload audio files
                        </div>
                    {% else %}
                        <div class="alert alert-danger my-2">
                            <span data-en="The model needs to be downloaded before it can be used"
                                  data-cn="需要下载模型后才可使用">
                                Model required
                            </span>
                            <a href="https://github.com/jianchang512/clone-voice/releases/tag/v0.0.1"
                               target="_blank" data-en="Download model" data-cn="下载模型">Download model</a>
                        </div>
                    {% endif %}
                    
                    <div class="alert alert-danger d-none" id="sts_no"></div>
                </div>
            </div>

            <!-- Output Section -->
            <div class="content-card">
                <div class="text-center">
                    <audio id="downloadbtn" class="d-none" controls style="width: 100%; max-width: 600px;"></audio>
                </div>
                
                <div class="my-2 d-none text-danger text-center" id="nostart"></div>
                
                <div class="text-center mt-3">
                    <button id="start_button" class="btn btn-danger btn-lg"
                            data-en="Start Generating" data-cn="立即开始生成">Start Generating</button>
                </div>
                
                <div class="d-none text-danger text-center mt-2" id="tips"></div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/layer/layer.js"></script>
    <script src="/static/js/bootstrap.bundle.min.js"></script>
    
    <!-- Application Entry Point -->
    <script type="module">
        import app from '/static/js/app.js';
        
        // Initialize application when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            // Configuration from Flask template
            const config = {
                language: '{{ language }}',
                version: '{{ version }}',
                textModel: {{ 'true' if text_model else 'false' }},
                voiceModel: {{ 'true' if voice_model else 'false' }},
                rootDir: '{{ root_dir }}'
            };
            
            // Initialize the app
            app.init(config);
        });
        
        // Global function for mode toggle (needed for inline onclick)
        window.toggleMode = (el, type) => {
            const buttons = el.parentElement.querySelectorAll('.btn');
            buttons.forEach(btn => btn.classList.remove('btn-primary'));
            el.classList.add('btn-primary');
            app.toggleMode(type);
        };
    </script>
</body>
</html>
